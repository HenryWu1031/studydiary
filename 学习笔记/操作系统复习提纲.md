<h1>操作系统复习提纲</h1>

## 第一章 导论

#### 中断

- 指当出现需要时，CPU暂时停止当前程序的执行，转而执行处理新情况的程序和执行过程

- 中断号：外部设备进行I/O操作时产生的中断信号，发送给CPU
- 中断向量：中断服务程序的入口地址
- 中断服务程序：执行中断处理的代码
- 操作系统是中断驱动

#### 双重模式

- 允许OS保护自身和其他系统部件
- 用户模式和内核模式
- 由硬件提供模式位
- 特权指令：可能引起系统崩溃的指令，只能运行在内核模式

#### I/O和内存保护

- I/O保护
  - 防止用户程序执行非法I/O
  - 解决方法：所有I/O指令都是特权指令
  - 用户程序通过系统调用进行I/O操作
- 内存保护
  - 防止内存非法访问
  - 解决方法：存储保护机制
  - 硬件支持

## 第二章 操作系统结构

#### 操作系统服务形式

- 系统调用
- 用户接口
- 系统程序

![image-20210113151409969](C:\Users\why19991031\AppData\Roaming\Typora\typora-user-images\image-20210113151409969.png)

## 第三章 进程

#### 内存中的进程

- 进程包括
  - 代码
  - 当前活动
    - 程序计数器：指向当前要执行的指令（地址）
    - 堆栈：存放函数参数、临时变量等临时数据
    - 数据：全局变量，处理的文件
    - 堆：动态内存分配

#### 进程和程序

- 进程是程序的一个实例，是程序的一次执行
- 一个程序可对应一个或多个进程，同样一个进程可对应一个或多个程序
- 程序是进程的代码部分
- 进程是活动实体，程序是静止实体
- 进程在内存，程序在外存

进程状态

- 新建：在创建进程
- 运行：指令在执行
- 等待：进程等待某些事件发生
- 就绪：进程等待分配处理器
- 终止：进程执行完毕

![image-20210113163533109](C:\Users\why19991031\AppData\Roaming\Typora\typora-user-images\image-20210113163533109.png)

#### 进程控制块

- 进程状态
- 程序计数器
- CPU寄存器
- CPU调度信息
- 内存管理信息
- 记账信息
- I/O状态信息

#### 多线程编程

#### 线程结构

- 代码和数据：来自进程
- 各类资源：来自进程
- 线程控制块：
  - 线程ID
  - 程序计数器PC
  - 寄存器集
  - 栈空间

#### 线程优点

- 响应度高
  - 线程创建开销小
  - 例子：Web服务器
- 资源共享
  - 进程中的线程可以共享进程资源
- 经济性
  - 线程创建、上下文切换比进程快
  - Solaris：创建线程比进程快30倍，线程切换比进程切换快5倍

#### 用户线程

由用户线程库进行管理的线程

- 内核看不到用户线程
- 用户线程的创建和调度在用户空间中，不需要内核的干预
- 应用于传统的只支持进程的操作系统

#### 内核线程

内核进行管理的线程

- 需要内核支持
- 由内核完成线程调度
- 由内核进行创建和撤销

#### 多对一模型

- 不支持内核线程的操作系统
  - 内核只有进程
- 内核只看到一个进程
  - 多个线程不能并行的运行在多个处理器上
- 进程中的用户线程自己管理
  - 进程内线程切换不会导致进程切换
  - 一个线程的系统调用会导致整个进程阻塞

#### 一对一模型

- 用于支持线程的操作系统
  - 用户线程映射到内核线程
  - 操作系统管理这些线程
- 并发性好：多个线程可并行运行在多个处理器上
- 内核开销大
- 例子
  - Windows
  - OS/2

#### 多对多模型

- 多个用户线程映射为相等或更小数目的内核线程
  - 并发性和效率兼顾
  - 增加复杂度
- 例子
  - Solaris 9 以前的版本

## 第五章 进程调度

#### 长程调度和短程调度的比较

- 切换频率
  - 短程调度切换频率高
  - 长程调度切换频率低
- 切换开销
  - 短程调度开销小
  - 长程调度开销大
- 操作系统中应用
  - 短程调度：必须
  - 长程调度：可选

#### CPU调度时机

- CPU调度可能发生在一个进程：
  - 从运行转向等待（非抢占式）
  - 从运行转到就绪（抢占式）
  - 从等待转到就绪（抢占式）
  - 终止运行（非抢占式）

#### 调度准则基本指标

![image-20210113191315549](C:\Users\why19991031\AppData\Roaming\Typora\typora-user-images\image-20210113191315549.png)

## 第六章 同步











## 第七章 死锁

- 银行家算法
- 7.7 7.8

<h2>第八章 内存管理策略</h2>

### 知识点：

1、基地址寄存器含有最小的合法的物理内存地址，而界限地址寄存器指定了范围的大小。

2、CPU可以直接访问的存储器只有主存和寄存器

3、寄存器通常可以在一个CPU时钟周期中完成访问，完成主存访问需要多个CPU时钟周期

4、多任务系统的操作系统在进行上下文切换时，应将一个进程的寄存器的状态存到内存，再从内存中调入下个进程的上下文到寄存器

##### 地址绑定

1、CPU生成的地址通常称为逻辑地址，而内存单元看到的地址通常称为物理地址

2、从虚拟地址到物理地址的运行时映射是由内存管理单元的硬件设备来完成。

##### 连续内存分配

1、主存通常被分为两部分，操作系统（通常驻留在低端）、用户进程（保存在内存高端）

2、用于内存分配的首次适应和最优适应算法都有外部碎片的问题。

3、可变分区的三种适应方法中首次适应和最佳适应在速度和存储空间的利用上要好于最差适应。

| 外部碎片                                             | 内部碎片                                                     |
| ---------------------------------------------------- | ------------------------------------------------------------ |
| 整个可用内存空间可以用来满足一个请求，但它不是连续的 | 分配的内存可能比申请的内存大一点，这两者之间的差别是在分区内部，但又不被使用 |

#### 分页

1、出现的原因进程物理地址空间可能不连续

2、把物理内存分成大小固定的块，称为帧，把逻辑内存也分为大小固定的块，成为页

3、建议一个页表，把逻辑地址转换为物理地址

4、存在内碎片

![QQ截图20201229141114](C:\Users\why19991031\Pictures\QQ截图20201229141114.png)

5、分页之后主要有页码和页偏移

##### 页表结构

说明：

1、32位逻辑地址，可以有$2^{32}$个地址，页大小4KB（$2^{12}$B）

2、一个页表最多可包含1百万个表项



#### 分段

1、一个逻辑地址是两个向量的集合：

<segment-number,offset>

2、段页式原理：先将用户程序分成若干个段，再把每个段分成若干个页并为每个段赋予一个段号

#### 内存扩充技术

- 紧缩（可变分区）

- 覆盖技术

  - 只在内存中保留那些在任何时间都需要的指令和数据
  - 程序的不同部分在内存中相互替换

- 交换技术

  - 一个进程可以暂时被交换到内存外的一个备份区，随后可以被换回内存继续执行
  - 交换较为耗时，因为文件比较大但是读取速度有限
  - 标准交换技术在现代操作系统中一般很少使用

- 虚拟内存

  

## 第九章 虚拟内存管理

#### 背景

1、代码必须装入内存才能执行，但是并不是所有代码必须全部装入内存

- 错误代码
- 不常用的函数
- 大的数据结构

2、局部性原理：一个程序只要部分装入内存就可以运行，以下是它的优点：

- 进程大小不再受到物理内存大小限制
- 每个进程需要的内存更小
- 更多进程可以并发运行
- I/O更少

#### 虚拟内存技术

1、虚拟地址空间：分配给进程的虚拟内存

2、虚拟地址：在虚拟内存中指令或数据的位置

3、虚拟内存：把内存和磁盘有机结合起来使用，得到一个容量很大的“内存”，即虚存

#### 虚拟内存的实现

虚拟存储器的大小由2个因素决定：

- 操作系统字长
- 内存外村容量和

虚拟内存能够通过一下手段来执行实现：

- 虚拟页式
- 虚拟段式

#### 虚拟页式存储管理

只有在一个页需要的时候才把它换入内存

- 需要很少的I/O
- 需要很少的内存
- 快速响应
- 多用户

每一个页表的表项有一个有效-无效位相关联：

- 1表示在内存，0表示不在内存

##### 缺页中断

##### 基本页置换方法

1、查找所需页在磁盘上的位置

2、查找一空闲页框

- 如果有空闲页框就使用它
- 如果没有空闲页框，使用页置换算法选择一个“牺牲”页框
- 将“牺牲”帧的内容写到磁盘上，更新页表和帧表

3、将所需页读入（新）空闲页框，更新页表和帧表

4、重启用户进程

#### 页面置换算法

- 最优置换算法（OPT）
  - 被置换的页是将来不再需要的或最远的将来才会被使用的页
  - 实现？我们可以看到是非常难以实现的这个算法
  - 作用：作为一种标准来衡量其他算法的性能
- 先进先出置换算法(FIFO)
  - 置换在内存中驻留时间最长的页面
  - 容易理解和实现、但性能不总是很好
  - 实现：使用FIFO队列管理内存中的所有页
  - ![image-20201230003452157](C:\Users\why19991031\AppData\Roaming\Typora\typora-user-images\image-20201230003452157.png)
- 最近最少使用置换算法（LRU）
  - 置换最长时间没有使用的页
  - 性能接近OPT
  - 实现：计数器(时间戳)或栈
  - 开销大、需要硬件支持
  - ![image-20201230003907008](C:\Users\why19991031\AppData\Roaming\Typora\typora-user-images\image-20201230003907008.png)
- 近似LRU算法

### 系统颠簸

#### 页框分配

必须满足的条件：每个进程所需要的最少的页数

两个最主要的分配策略

- 固定分配
  - 平均分配-均分法
    - 例：如果有100个页框，和5个进程，则每个进程分给20个页
  - 按比率分配-根据每个进程的大小来分配

- 优先级分配
  - 根据优先级而不是进程大小来使用比率分配策略
  - 如果进程$P~i$产生一个缺页
    - 选择替换其中的一个页框
    - 从一个较低优先级的进程中选择一个页面来替换

#### 全局置换和局部置换

- 全局置换-进程在所有的页框中选择一个替换页面：一个进程可以从另一个进程中获得页框
- 局部置换-每个进程只从属于它自己的页框中选择

### 颠簸

含义：一个进程的页面经常换入换出

为什么颠簸会发生：分配的页框数 < 局部大小之和

#### 缺页率策略

设置可接受的缺页率

- 如果缺页率太低，回收一些进程的页框
- 如果缺页率太高，就分给进程一些页框

### 内核内存分配

不同于用户内存

通常从空闲内存池中获取

- 内核需要为不同大小的数据结构分配内存
- 一些内核内存需要连续的物理页

内核在使用内存块时有的特点

- 内存块的尺寸比较小
- 占用内存块的时间比较短
- 要求快速完成分配和回收
- 不参与交换
- 频繁使用尺寸相同的内存块，存放同一数据结构
- 要求动态分配和回收

#### Buddy系统

- 主要用于Linux早期版本中内核底层内存管理
- 主要思想：内存按2的幂的大小进行划分，即4KB、8KB等，组成若干空闲块链表；查找链表找到满足进程需求的最佳匹配块

### 预先调页

- 在进程启动初期，减少大量的缺页中断
- 在引用前，调入进程的所有或一些需要的页面
- 如果预调入的页面没有被使用，则内存被浪费

#### 页面尺寸选择

- 碎片-需要小的页
- 表大小-需要大的页
- I/O开销-需要大的页
- 程序局部-需要小的页
- 缺页次数-需要大的页

没有最佳答案，总的来说，趋向更大的页

#### I/O互锁

- 允许某些页在内存中那个被锁住
- I/O时，正在进行I/O的页面不允许被置换算法置换出内存

## 第十章 文件系统接口

#### 文件概念

- 计算机中信息存储的基本组织形式
- 相关信息结合
- 具有文件名

#### 文件结构

- 无结构：文字流、字节流等
- 简单记录结构：线性、固定长度、可变长度等
- 复杂结构：格式化文档、多媒体文件等

谁决定了文件结构

- 操作系统
- 程序

#### 文件类型-扩展名

- 文件类型一般由扩展名决定
- 文件扩展名
  - 也称文件后缀名
  - 标识文件类型的一种机制
  - 扩展名跟在主文件名后面，有一个分隔符“.”分隔

### 逻辑文件及其访问方法

#### 逻辑文件

- 文件呈现在用户面前的组织结构
- 又称为文件逻辑结构
- 逻辑文件决定了文件访问方法

#### 文件访问方式

1、顺序访问

- 磁带
  - 优点：节省存储空间   缺点：访问效率差

2、直接（随机）访问

- 磁盘
  - 缺点：浪费存储空间   优点：访问效率好

#### 索引文件

基本方法：为顺序文件建立索引表

![image-20201230090928543](C:\Users\why19991031\AppData\Roaming\Typora\typora-user-images\image-20201230090928543.png)

### 文件目录

#### 文件控制块（FCB）

- 存放操控文件所需的各类文件属性信息
  - 文件名
  - 长度
  - 创建时间
  - 存放位置
  - 访问控制权限

- 类似一个索引项

#### 目录项

- 存放一个文件的各类属性
- 有的系统等同于文件控制块

#### 目录

- 包含着所有文件信息的节点集合
- 根据文件名检索文件的桥梁
- 目录项的有序集合

#### 目录文件

- 目录组织形式
- 目录作为一个文件存在于文件系统

#### 目录和文件

- 每个目录项中存放了文件在存储设备的存放地址
- 目录和文件都驻留在存储设备
- ![image-20201230092113475](C:\Users\why19991031\AppData\Roaming\Typora\typora-user-images\image-20201230092113475.png)

#### 文件检索过程

- 文件检索是一个遍历目录项的过程
  - 打开目录文件
  - 从磁盘读入该目录文件的1个（物理）块，该块包含若干个目录项
  - 根据文件名遍历内存中的该块，如找到则结束
  - 判断该目录文件是否还有物理块没有读入，如果是转2；否则，结束。表示该目录没有此文件名的文件

目录项由于经常变化，一般不排序

平均遍历目录项数：（1+n）/2

不包括文件查不到的情况

#### i Node（降低ds）

![image-20201230092733885](C:\Users\why19991031\AppData\Roaming\Typora\typora-user-images\image-20201230092733885.png)

#### 文件保护

- 文件的所有者/创建者应该有权控制：
  - 能做什么
  - 由谁来做

- 文件存取类型
  - 读
  - 写
  - 执行
  - 添加
  - 删除
  - 列表清单

#### 访问控制列表和分组

- 访问模式：读/写/执行
- 三种类型的用户
  - a）所有者                    7         =》  RWX        1 1  1
  - a）组用户                    6         =》  RWX        1 1  0
  - a）所有者                    1         =》  RWX        0 0  1

- 建立一个组，加入一些用户
- 对特定的文件或目录（game），定义适当的访问权限
- ![image-20201231002141228](C:\Users\why19991031\AppData\Roaming\Typora\typora-user-images\image-20201231002141228.png)

### 文件系统——目录结构

- 单层目录
- 双层目录
- 树形目录
- 无环图目录
- 通用图目录

#### 目录结构的设计目标

- 效率
  - 快速定位文件位置
  - 提高文件访问效率
- 命名
  - 方便用户使用
  - 同名的不同文件
  - 不同名的相同文件
- 分组
  - 文件分组（子目录）
  - 兼顾效率和方便性

1、单层目录

- 所有文件在同一目录中，只有一级目录：根目录
- 根目录（/）：一个文件系统最顶层的目录
- 优点：结构简单
- 缺点
  - 检索效率差（目录下文件过多）
  - 不能有同名文件，一个文件只能有一个名称
  - 不能分组

![image-20201231003550433](C:\Users\why19991031\AppData\Roaming\Typora\typora-user-images\image-20201231003550433.png)

#### 双层目录

- 每个用户有自己的目录结构
- 目录下的目录
- 缺点：1）无法分组；2）同一用户不能有相同文件名的文件
- 优点：1）不同用户可有相同文件名的文件；2）比单层目录提高检索效率（文件分布在多个用户目录中）
- 路径名
  - 不同目录存在同名文件，为了区分引入了路径
  - 从根目录开始到文件的路径，称为路径名
    - /user4/a
    - /user1/a

![image-20201231004607303](C:\Users\why19991031\AppData\Roaming\Typora\typora-user-images\image-20201231004607303.png)

#### 树型目录

- 双层目录的扩展：2层--->N层

![image-20201231004817127](C:\Users\why19991031\AppData\Roaming\Typora\typora-user-images\image-20201231004817127.png)